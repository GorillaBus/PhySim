{"version":3,"sources":["node_modules/browser-pack/_prelude.js","projects/bezier-curves/app.js","src/feature-toggle.js","src/lib/AnimationPlayer.js","src/lib/Utils.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import Utils from '../../src/lib/Utils';\nimport AnimationPlayer from '../../src/lib/AnimationPlayer';\n\nwindow.onload = () => {\n  const canvas = document.getElementById(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  const width = canvas.width = window.innerWidth-4;\n  const height = canvas.height = window.innerHeight-4;\n\n  let increment = 0.01;\n  let player = new AnimationPlayer();;\n\n  let t = 0;\n  let direction = true;\n  let p0 = {\n    x: 100,\n    y: height / 2\n  };\n  let p1 = {\n    x: width - 100,\n    y: height / 2\n  };\n  // Curve point for cuadratic bezier\n  let p2 = {\n    x: width - 850,\n    y: height - 150\n  };\n  // An extra point to use with cubic bezier\n  let p3 = {\n    x: width - 400,\n    y: height - 750\n  };\n  let pResult = {\n    x: 0,\n    y: 0\n  };\n\n\n  // Demo player\n  player.setUpdateFn(update);\n  player.play();\n\n\n  // Frame drawing function\n  function update() {\n    ctx.clearRect(0,0, width, height);\n\n    // Calculate a quadratic bezier\n    Utils.quadraticBezier(p0, p2, p1, t, pResult);\n\n    // Replace with this for Cubic Bezier\n    //Utils.cubicBezier(p0, p2, p3, p1, t, pResult);\n\n    t += increment;\n\n    if (t >= 1) {\n      t = 1;\n      increment *= -1;\n    } else if (t <= 0) {\n      t = 0;\n      increment *= -1;\n    }\n\n    ctx.beginPath();\n    ctx.arc(p0.x, p0.y, 10, 0, Math.PI * 2, false);\n    ctx.fillStyle = \"red\";\n    ctx.fill();\n    ctx.closePath();\n\n    ctx.beginPath();\n    ctx.arc(p1.x, p1.y, 10, 0, Math.PI * 2, false);\n    ctx.fillStyle = \"red\";\n    ctx.fill();\n    ctx.closePath();\n\n    ctx.beginPath();\n    ctx.arc(p2.x, p2.y, 10, 0, Math.PI * 2, false);\n    ctx.fillStyle = \"green\";\n    ctx.fill();\n    ctx.closePath();\n\n    // Uncomment to test the Cubic Bezier\n    /*\n    ctx.beginPath();\n    ctx.arc(p3.x, p3.y, 10, 0, Math.PI * 2, false);\n    ctx.fillStyle = \"yellow\";\n    ctx.fill();\n    ctx.closePath();\n    */\n\n    ctx.beginPath();\n    ctx.arc(pResult.x, pResult.y, 5, 0, Math.PI * 2, false);\n    ctx.fillStyle = \"#000000\";\n    ctx.fill();\n    ctx.closePath();\n  }\n\n\n  // Mouse click: sets the bezier curve point position\n  document.body.addEventListener(\"click\", (e) => {\n    p2.x = e.clientX;\n    p2.y = e.clientY;\n  });\n\n  // Animation control: KeyDown\n  document.body.addEventListener(\"keydown\", (e) => {\n    //console.log(\"Key pressed: \", e.keyCode);\n    switch (e.keyCode) {\n      case 27:                        // Esc\n      if (player.playing) {\n        player.stop();\n        console.log(\"> Scene stopped\");\n      } else {\n        player.play();\n        console.log(\"> Playing scene\");\n      }\n      break;\n      default:\n      break;\n    }\n  });\n};\n","/*\n *  Feature Toggling\n *\n *  Activete/Hide features that are in process of development or under testing\n *  Once a feature is accepted to be includded must be removed from the\n *  feature toggle scheme\n */\n\n const FEATURE_TOGGLE = {\n   FPS_CONTROL: true                // FPS controll for AnimationPlayer class\n };\n\n export default FEATURE_TOGGLE;\n","import FEATURE_TOGGLE from '../../src/feature-toggle';\n\nexport default class AnimationPlayer {\n\n  constructor(settings) {\n    settings = settings || {};\n\n    this.window = settings.windowElement || window;\n    this.requestId = null;\n    this.playing = false;\n\n    // FPS control\n    this.fps = settings.fps || 90;\n    this.now;\n    this.lastTime = Date.now();\n    this.interval = 1000/this.fps;\n    this.delta;\n\n    this.registerEvents();\n  }\n\n  registerEvents() {\n    // Animation control: KeyDown\n    document.body.addEventListener(\"keydown\", (e) => {\n      //console.log(\"Key pressed: \", e.keyCode);\n      switch (e.keyCode) {\n        case 27:                        // Esc\n        if (this.playing) {\n          this.stop();\n          console.log(\"> Scene stopped\");\n        } else {\n          this.play();\n          console.log(\"> Playing scene\");\n        }\n        break;\n\n        case 13:\n        this.stop();\n        this.play();\n        this.stop();\n        console.log(\"> Step forward\");\n        break;\n\n        default:\n        break;\n      }\n    });\n  }\n\n  play() {\n    this.playing = true;\n    this.updateFn();\n  }\n\n  stop() {\n    if (!this.playing) {\n      return false;\n    }\n    this.window.cancelAnimationFrame(this.requestId);\n    this.playing = false;\n    this.requestId = null;\n  }\n\n  setUpdateFn(updateFn) {\n    this.updateFn = (\n      () => {\n        this.requestId = this.window.requestAnimationFrame(this.updateFn);\n        this.now = Date.now();\n        this.delta = this.now - this.lastTime;\n\n        if (this.delta > this.interval) {\n          this.lastTime = this.now - (this.delta % this.interval);\n          updateFn(this.delta, this.lastTime);\n        }\n        return;\n\n\n        updateFn();\n\n      });\n    }\n\n    updateFn() {\n      console.warn(\"Player update function has not been set.\");\n    }\n  }\n","import FEATURE_TOGGLE from '../../src/feature-toggle';\n\nclass Utils {\n\n  constructor() {\n    this.cache = {};\n  }\n\n  cacheStore(caller, key, value) {\n    if (!this.cache.hasOwnProperty(caller)) {\n      this.cache[caller] = {};\n    }\n    this.cache[caller][key] = value;\n  }\n\n  cacheRetrieve(caller, key) {\n    let fnCache = this.cache[caller] || [];\n    let value = fnCache[key] || false;\n    return value;\n  }\n\n  /*\n   *  Get 'n' points from a circular shaped 'Particle' object\n   */\n  getCirclePoints(p, n, radius) {\n    n = n || 8;\n    radius = radius || p.radius || 0;\n\n    let angle = -1;\n    let angleStep = (Math.PI * 2) / n;\n    let points = [];\n\n    for (let i=0; i<n; i++) {\n      let cData = this.cacheRetrieve(\"getCirclePoints\", angle);\n      let cos = cData.cos || Math.cos(angle);\n      let sin = cData.sin || Math.sin(angle);\n      let pt = {\n        x: p.x + (cos * p.radius),\n        y: p.y + (sin * p.radius)\n      };\n      points.push(pt);\n      if (!cData) {\n        this.cacheStore(\"getCirclePoints\", angle, {cos: cos, sin: sin});\n      }\n      angle += angleStep;\n    }\n\n    // Add the center point\n    return points;\n  }\n\n  montecarlo() {\n    while(true) {\n      let r1 = Math.random();\n      let p = r1;\n      let r2 = Math.random();\n      if (r2 < p) {\n        return r1;\n      }\n    }\n  }\n\n  lerp(norm, min, max) {\n    return (max - min) * norm + min;\n  }\n\n  quadraticBezier(p0, p1, p2, t, pFinal) {\n    pFinal = pFinal || {};\n    pFinal.x = Math.pow(1 - t, 2) * p0.x + (1 - t) * 2 * t * p1.x + t * t * p2.x;\n    pFinal.y = Math.pow(1 - t, 2) * p0.y + (1 - t) * 2 * t * p1.y + t * t * p2.y;\n    return pFinal;\n  }\n\n  cubicBezier(p0, p1, p2, p3, t, pFinal) {\n    pFinal = pFinal || {};\n    pFinal.x = Math.pow(1 - t, 3) * p0.x + Math.pow(1 - t, 2) * 3 * t * p1.x + (1 - t) * 3 * t * t * p2.x + t * t * t * p3.x;\n    pFinal.y = Math.pow(1 - t, 3) * p0.y + Math.pow(1 - t, 2) * 3 * t * p1.y + (1 - t) * 3 * t * t * p2.y + t * t * t * p3.y;\n    return pFinal;\n  }\n\n  distance(p0, p1) {\n    let dx = p0.x - p1.x;\n    let dy = p0.y - p1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  distanceXY(x0, y0, x1, y1) {\n    let dx = x1 - x0;\n    let dy = y1 - y0;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  // TODO: Check if and why we need to parseInt() the result\n  mapRange(value, low1, high1, low2, high2) {\n    return result = low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n    let result = low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n    if (low2 === parseInt(low2, 10) || high2 === parseInt(high2, 10)) {\n      result = parseInt(result);\n    }\n    return result;\n  }\n\n  inRange(value, min, max) {\n    return value >= Math.min(min, max) && value <= Math.max(min, max);\n  }\n\n  rangeIntersect(min0, max0, min1, max1) {\n    return  Math.max(min0, max0) >= Math.min(min1, max1) &&\n    Math.min(min0, max0) <= Math.max(min1, max1);\n  }\n\n  randomRange(min, max) {\n    return min + Math.random() * (max - min);\n  }\n\n  constrain(e,t,r) {\n    return e>r?r:e<t?t:e;\n  }\n\n  circleCollision(c0, c1) {\n    return this.distance(c0, c1) <= c0.radius + c1.radius;\n  }\n\n  rectangleCollision(r0, r1) {\n    return  this.rangeIntersect(r0.x, r0.x + r0.width, r1.x, r1.x + r1.width) &&\n    this.rangeIntersect(r0.y, r0.y + r0.height, r1.y, r1.y + r1.height);\n  }\n\n  circlePointCollision(px, py, circle) {\n    return this.distanceXY(px, py, circle.x, circle.y) < circle.radius;\n  }\n\n  rectanglePointCollision(px, py, rect) {\n    return  this.inRange(px, rect.x, rect.x + rect.width) &&\n    this.inRange(py, rect.y, rect.y + rect.height);\n  }\n\n  uniqueID() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n      s4() + '-' + s4() + s4() + s4();\n  }\n\n  randomColor() {\n    return \"#000000\".replace(/0/g,function(){return (~~(Math.random()*16)).toString(16);});\n  }\n}\n\nlet instance = new Utils();\n\nexport default instance;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwcm9qZWN0cy9iZXppZXItY3VydmVzL2FwcC5qcyIsInNyYy9mZWF0dXJlLXRvZ2dsZS5qcyIsInNyYy9saWIvQW5pbWF0aW9uUGxheWVyLmpzIiwic3JjL2xpYi9VdGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7Ozs7QUFDQTs7Ozs7O0FBRUEsT0FBTyxNQUFQLEdBQWdCLFlBQU07QUFDcEIsTUFBTSxTQUFTLFNBQVMsY0FBVCxDQUF3QixRQUF4QixDQUFmO0FBQ0EsTUFBTSxNQUFNLE9BQU8sVUFBUCxDQUFrQixJQUFsQixDQUFaO0FBQ0EsTUFBTSxRQUFRLE9BQU8sS0FBUCxHQUFlLE9BQU8sVUFBUCxHQUFrQixDQUEvQztBQUNBLE1BQU0sU0FBUyxPQUFPLE1BQVAsR0FBZ0IsT0FBTyxXQUFQLEdBQW1CLENBQWxEOztBQUVBLE1BQUksWUFBWSxJQUFoQjtBQUNBLE1BQUksU0FBUywrQkFBYixDQUFtQzs7QUFFbkMsTUFBSSxJQUFJLENBQVI7QUFDQSxNQUFJLFlBQVksSUFBaEI7QUFDQSxNQUFJLEtBQUs7QUFDUCxPQUFHLEdBREk7QUFFUCxPQUFHLFNBQVM7QUFGTCxHQUFUO0FBSUEsTUFBSSxLQUFLO0FBQ1AsT0FBRyxRQUFRLEdBREo7QUFFUCxPQUFHLFNBQVM7QUFGTCxHQUFUO0FBSUE7QUFDQSxNQUFJLEtBQUs7QUFDUCxPQUFHLFFBQVEsR0FESjtBQUVQLE9BQUcsU0FBUztBQUZMLEdBQVQ7QUFJQTtBQUNBLE1BQUksS0FBSztBQUNQLE9BQUcsUUFBUSxHQURKO0FBRVAsT0FBRyxTQUFTO0FBRkwsR0FBVDtBQUlBLE1BQUksVUFBVTtBQUNaLE9BQUcsQ0FEUztBQUVaLE9BQUc7QUFGUyxHQUFkOztBQU1BO0FBQ0EsU0FBTyxXQUFQLENBQW1CLE1BQW5CO0FBQ0EsU0FBTyxJQUFQOztBQUdBO0FBQ0EsV0FBUyxNQUFULEdBQWtCO0FBQ2hC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VCxHQUFjO0FBQ1osZUFBTyxLQUFLLEtBQUwsQ0FBVyxDQUFDLElBQUksS0FBSyxNQUFMLEVBQUwsSUFBc0IsT0FBakMsRUFDSixRQURJLENBQ0ssRUFETCxFQUVKLFNBRkksQ0FFTSxDQUZOLENBQVA7QUFHRDtBQUNELGFBQU8sT0FBTyxJQUFQLEdBQWMsR0FBZCxHQUFvQixJQUFwQixHQUEyQixHQUEzQixHQUFpQyxJQUFqQyxHQUF3QyxHQUF4QyxHQUNMLElBREssR0FDRSxHQURGLEdBQ1EsSUFEUixHQUNlLElBRGYsR0FDc0IsSUFEN0I7QUFFRDs7O2tDQUVhO0FBQ1osYUFBTyxVQUFVLE9BQVYsQ0FBa0IsSUFBbEIsRUFBdUIsWUFBVTtBQUFDLGVBQU8sQ0FBQyxDQUFDLEVBQUUsS0FBSyxNQUFMLEtBQWMsRUFBaEIsQ0FBRixFQUF1QixRQUF2QixDQUFnQyxFQUFoQyxDQUFQO0FBQTRDLE9BQTlFLENBQVA7QUFDRDs7Ozs7O0FBR0gsSUFBSSxXQUFXLElBQUksS0FBSixFQUFmOztrQkFFZSxRIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCBVdGlscyBmcm9tICcuLi8uLi9zcmMvbGliL1V0aWxzJztcbmltcG9ydCBBbmltYXRpb25QbGF5ZXIgZnJvbSAnLi4vLi4vc3JjL2xpYi9BbmltYXRpb25QbGF5ZXInO1xuXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKTtcbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgY29uc3Qgd2lkdGggPSBjYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aC00O1xuICBjb25zdCBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0LTQ7XG5cbiAgbGV0IGluY3JlbWVudCA9IDAuMDE7XG4gIGxldCBwbGF5ZXIgPSBuZXcgQW5pbWF0aW9uUGxheWVyKCk7O1xuXG4gIGxldCB0ID0gMDtcbiAgbGV0IGRpcmVjdGlvbiA9IHRydWU7XG4gIGxldCBwMCA9IHtcbiAgICB4OiAxMDAsXG4gICAgeTogaGVpZ2h0IC8gMlxuICB9O1xuICBsZXQgcDEgPSB7XG4gICAgeDogd2lkdGggLSAxMDAsXG4gICAgeTogaGVpZ2h0IC8gMlxuICB9O1xuICAvLyBDdXJ2ZSBwb2ludCBmb3IgY3VhZHJhdGljIGJlemllclxuICBsZXQgcDIgPSB7XG4gICAgeDogd2lkdGggLSA4NTAsXG4gICAgeTogaGVpZ2h0IC0gMTUwXG4gIH07XG4gIC8vIEFuIGV4dHJhIHBvaW50IHRvIHVzZSB3aXRoIGN1YmljIGJlemllclxuICBsZXQgcDMgPSB7XG4gICAgeDogd2lkdGggLSA0MDAsXG4gICAgeTogaGVpZ2h0IC0gNzUwXG4gIH07XG4gIGxldCBwUmVzdWx0ID0ge1xuICAgIHg6IDAsXG4gICAgeTogMFxuICB9O1xuXG5cbiAgLy8gRGVtbyBwbGF5ZXJcbiAgcGxheWVyLnNldFVwZGF0ZUZuKHVwZGF0ZSk7XG4gIHBsYXllci5wbGF5KCk7XG5cblxuICAvLyBGcmFtZSBkcmF3aW5nIGZ1bmN0aW9uXG4gIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBjdHguY2xlYXJSZWN0KDAsMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYSBxdWFkcmF0aWMgYmV6aWVyXG4gICAgVXRpbHMucXVhZHJhdGljQmV6aWVyKHAwLCBwMiwgcDEsIHQsIHBSZXN1bHQpO1xuXG4gICAgLy8gUmVwbGFjZSB3aXRoIHRoaXMgZm9yIEN1YmljIEJlemllclxuICAgIC8vVXRpbHMuY3ViaWNCZXppZXIocDAsIHAyLCBwMywgcDEsIHQsIHBSZXN1bHQpO1xuXG4gICAgdCArPSBpbmNyZW1lbnQ7XG5cbiAgICBpZiAodCA+PSAxKSB7XG4gICAgICB0ID0gMTtcbiAgICAgIGluY3JlbWVudCAqPSAtMTtcbiAgICB9IGVsc2UgaWYgKHQgPD0gMCkge1xuICAgICAgdCA9IDA7XG4gICAgICBpbmNyZW1lbnQgKj0gLTE7XG4gICAgfVxuXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5hcmMocDAueCwgcDAueSwgMTAsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7XG4gICAgY3R4LmZpbGxTdHlsZSA9IFwicmVkXCI7XG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguY2xvc2VQYXRoKCk7XG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LmFyYyhwMS54LCBwMS55LCAxMCwgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCJyZWRcIjtcbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcblxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHguYXJjKHAyLngsIHAyLnksIDEwLCAwLCBNYXRoLlBJICogMiwgZmFsc2UpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBcImdyZWVuXCI7XG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguY2xvc2VQYXRoKCk7XG5cbiAgICAvLyBVbmNvbW1lbnQgdG8gdGVzdCB0aGUgQ3ViaWMgQmV6aWVyXG4gICAgLypcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LmFyYyhwMy54LCBwMy55LCAxMCwgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCJ5ZWxsb3dcIjtcbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAqL1xuXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5hcmMocFJlc3VsdC54LCBwUmVzdWx0LnksIDUsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7XG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiIzAwMDAwMFwiO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICB9XG5cblxuICAvLyBNb3VzZSBjbGljazogc2V0cyB0aGUgYmV6aWVyIGN1cnZlIHBvaW50IHBvc2l0aW9uXG4gIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgcDIueCA9IGUuY2xpZW50WDtcbiAgICBwMi55ID0gZS5jbGllbnRZO1xuICB9KTtcblxuICAvLyBBbmltYXRpb24gY29udHJvbDogS2V5RG93blxuICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgLy9jb25zb2xlLmxvZyhcIktleSBwcmVzc2VkOiBcIiwgZS5rZXlDb2RlKTtcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgY2FzZSAyNzogICAgICAgICAgICAgICAgICAgICAgICAvLyBFc2NcbiAgICAgIGlmIChwbGF5ZXIucGxheWluZykge1xuICAgICAgICBwbGF5ZXIuc3RvcCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIj4gU2NlbmUgc3RvcHBlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBsYXllci5wbGF5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPiBQbGF5aW5nIHNjZW5lXCIpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgYnJlYWs7XG4gICAgfVxuICB9KTtcbn07XG4iLCIvKlxuICogIEZlYXR1cmUgVG9nZ2xpbmdcbiAqXG4gKiAgQWN0aXZldGUvSGlkZSBmZWF0dXJlcyB0aGF0IGFyZSBpbiBwcm9jZXNzIG9mIGRldmVsb3BtZW50IG9yIHVuZGVyIHRlc3RpbmdcbiAqICBPbmNlIGEgZmVhdHVyZSBpcyBhY2NlcHRlZCB0byBiZSBpbmNsdWRkZWQgbXVzdCBiZSByZW1vdmVkIGZyb20gdGhlXG4gKiAgZmVhdHVyZSB0b2dnbGUgc2NoZW1lXG4gKi9cblxuIGNvbnN0IEZFQVRVUkVfVE9HR0xFID0ge1xuICAgRlBTX0NPTlRST0w6IHRydWUgICAgICAgICAgICAgICAgLy8gRlBTIGNvbnRyb2xsIGZvciBBbmltYXRpb25QbGF5ZXIgY2xhc3NcbiB9O1xuXG4gZXhwb3J0IGRlZmF1bHQgRkVBVFVSRV9UT0dHTEU7XG4iLCJpbXBvcnQgRkVBVFVSRV9UT0dHTEUgZnJvbSAnLi4vLi4vc3JjL2ZlYXR1cmUtdG9nZ2xlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQW5pbWF0aW9uUGxheWVyIHtcblxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncykge1xuICAgIHNldHRpbmdzID0gc2V0dGluZ3MgfHwge307XG5cbiAgICB0aGlzLndpbmRvdyA9IHNldHRpbmdzLndpbmRvd0VsZW1lbnQgfHwgd2luZG93O1xuICAgIHRoaXMucmVxdWVzdElkID0gbnVsbDtcbiAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcblxuICAgIC8vIEZQUyBjb250cm9sXG4gICAgdGhpcy5mcHMgPSBzZXR0aW5ncy5mcHMgfHwgOTA7XG4gICAgdGhpcy5ub3c7XG4gICAgdGhpcy5sYXN0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5pbnRlcnZhbCA9IDEwMDAvdGhpcy5mcHM7XG4gICAgdGhpcy5kZWx0YTtcblxuICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKTtcbiAgfVxuXG4gIHJlZ2lzdGVyRXZlbnRzKCkge1xuICAgIC8vIEFuaW1hdGlvbiBjb250cm9sOiBLZXlEb3duXG4gICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgICAgLy9jb25zb2xlLmxvZyhcIktleSBwcmVzc2VkOiBcIiwgZS5rZXlDb2RlKTtcbiAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICAgIGNhc2UgMjc6ICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXNjXG4gICAgICAgIGlmICh0aGlzLnBsYXlpbmcpIHtcbiAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gU2NlbmUgc3RvcHBlZFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gUGxheWluZyBzY2VuZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIDEzOlxuICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIj4gU3RlcCBmb3J3YXJkXCIpO1xuICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHBsYXkoKSB7XG4gICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTtcbiAgICB0aGlzLnVwZGF0ZUZuKCk7XG4gIH1cblxuICBzdG9wKCkge1xuICAgIGlmICghdGhpcy5wbGF5aW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMud2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMucmVxdWVzdElkKTtcbiAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnJlcXVlc3RJZCA9IG51bGw7XG4gIH1cblxuICBzZXRVcGRhdGVGbih1cGRhdGVGbikge1xuICAgIHRoaXMudXBkYXRlRm4gPSAoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gdGhpcy53aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudXBkYXRlRm4pO1xuICAgICAgICB0aGlzLm5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuZGVsdGEgPSB0aGlzLm5vdyAtIHRoaXMubGFzdFRpbWU7XG5cbiAgICAgICAgaWYgKHRoaXMuZGVsdGEgPiB0aGlzLmludGVydmFsKSB7XG4gICAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRoaXMubm93IC0gKHRoaXMuZGVsdGEgJSB0aGlzLmludGVydmFsKTtcbiAgICAgICAgICB1cGRhdGVGbih0aGlzLmRlbHRhLCB0aGlzLmxhc3RUaW1lKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG5cblxuICAgICAgICB1cGRhdGVGbigpO1xuXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVGbigpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIlBsYXllciB1cGRhdGUgZnVuY3Rpb24gaGFzIG5vdCBiZWVuIHNldC5cIik7XG4gICAgfVxuICB9XG4iLCJpbXBvcnQgRkVBVFVSRV9UT0dHTEUgZnJvbSAnLi4vLi4vc3JjL2ZlYXR1cmUtdG9nZ2xlJztcblxuY2xhc3MgVXRpbHMge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2FjaGUgPSB7fTtcbiAgfVxuXG4gIGNhY2hlU3RvcmUoY2FsbGVyLCBrZXksIHZhbHVlKSB7XG4gICAgaWYgKCF0aGlzLmNhY2hlLmhhc093blByb3BlcnR5KGNhbGxlcikpIHtcbiAgICAgIHRoaXMuY2FjaGVbY2FsbGVyXSA9IHt9O1xuICAgIH1cbiAgICB0aGlzLmNhY2hlW2NhbGxlcl1ba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgY2FjaGVSZXRyaWV2ZShjYWxsZXIsIGtleSkge1xuICAgIGxldCBmbkNhY2hlID0gdGhpcy5jYWNoZVtjYWxsZXJdIHx8IFtdO1xuICAgIGxldCB2YWx1ZSA9IGZuQ2FjaGVba2V5XSB8fCBmYWxzZTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvKlxuICAgKiAgR2V0ICduJyBwb2ludHMgZnJvbSBhIGNpcmN1bGFyIHNoYXBlZCAnUGFydGljbGUnIG9iamVjdFxuICAgKi9cbiAgZ2V0Q2lyY2xlUG9pbnRzKHAsIG4sIHJhZGl1cykge1xuICAgIG4gPSBuIHx8IDg7XG4gICAgcmFkaXVzID0gcmFkaXVzIHx8IHAucmFkaXVzIHx8IDA7XG5cbiAgICBsZXQgYW5nbGUgPSAtMTtcbiAgICBsZXQgYW5nbGVTdGVwID0gKE1hdGguUEkgKiAyKSAvIG47XG4gICAgbGV0IHBvaW50cyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaT0wOyBpPG47IGkrKykge1xuICAgICAgbGV0IGNEYXRhID0gdGhpcy5jYWNoZVJldHJpZXZlKFwiZ2V0Q2lyY2xlUG9pbnRzXCIsIGFuZ2xlKTtcbiAgICAgIGxldCBjb3MgPSBjRGF0YS5jb3MgfHwgTWF0aC5jb3MoYW5nbGUpO1xuICAgICAgbGV0IHNpbiA9IGNEYXRhLnNpbiB8fCBNYXRoLnNpbihhbmdsZSk7XG4gICAgICBsZXQgcHQgPSB7XG4gICAgICAgIHg6IHAueCArIChjb3MgKiBwLnJhZGl1cyksXG4gICAgICAgIHk6IHAueSArIChzaW4gKiBwLnJhZGl1cylcbiAgICAgIH07XG4gICAgICBwb2ludHMucHVzaChwdCk7XG4gICAgICBpZiAoIWNEYXRhKSB7XG4gICAgICAgIHRoaXMuY2FjaGVTdG9yZShcImdldENpcmNsZVBvaW50c1wiLCBhbmdsZSwge2NvczogY29zLCBzaW46IHNpbn0pO1xuICAgICAgfVxuICAgICAgYW5nbGUgKz0gYW5nbGVTdGVwO1xuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgY2VudGVyIHBvaW50XG4gICAgcmV0dXJuIHBvaW50cztcbiAgfVxuXG4gIG1vbnRlY2FybG8oKSB7XG4gICAgd2hpbGUodHJ1ZSkge1xuICAgICAgbGV0IHIxID0gTWF0aC5yYW5kb20oKTtcbiAgICAgIGxldCBwID0gcjE7XG4gICAgICBsZXQgcjIgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgaWYgKHIyIDwgcCkge1xuICAgICAgICByZXR1cm4gcjE7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGVycChub3JtLCBtaW4sIG1heCkge1xuICAgIHJldHVybiAobWF4IC0gbWluKSAqIG5vcm0gKyBtaW47XG4gIH1cblxuICBxdWFkcmF0aWNCZXppZXIocDAsIHAxLCBwMiwgdCwgcEZpbmFsKSB7XG4gICAgcEZpbmFsID0gcEZpbmFsIHx8IHt9O1xuICAgIHBGaW5hbC54ID0gTWF0aC5wb3coMSAtIHQsIDIpICogcDAueCArICgxIC0gdCkgKiAyICogdCAqIHAxLnggKyB0ICogdCAqIHAyLng7XG4gICAgcEZpbmFsLnkgPSBNYXRoLnBvdygxIC0gdCwgMikgKiBwMC55ICsgKDEgLSB0KSAqIDIgKiB0ICogcDEueSArIHQgKiB0ICogcDIueTtcbiAgICByZXR1cm4gcEZpbmFsO1xuICB9XG5cbiAgY3ViaWNCZXppZXIocDAsIHAxLCBwMiwgcDMsIHQsIHBGaW5hbCkge1xuICAgIHBGaW5hbCA9IHBGaW5hbCB8fCB7fTtcbiAgICBwRmluYWwueCA9IE1hdGgucG93KDEgLSB0LCAzKSAqIHAwLnggKyBNYXRoLnBvdygxIC0gdCwgMikgKiAzICogdCAqIHAxLnggKyAoMSAtIHQpICogMyAqIHQgKiB0ICogcDIueCArIHQgKiB0ICogdCAqIHAzLng7XG4gICAgcEZpbmFsLnkgPSBNYXRoLnBvdygxIC0gdCwgMykgKiBwMC55ICsgTWF0aC5wb3coMSAtIHQsIDIpICogMyAqIHQgKiBwMS55ICsgKDEgLSB0KSAqIDMgKiB0ICogdCAqIHAyLnkgKyB0ICogdCAqIHQgKiBwMy55O1xuICAgIHJldHVybiBwRmluYWw7XG4gIH1cblxuICBkaXN0YW5jZShwMCwgcDEpIHtcbiAgICBsZXQgZHggPSBwMC54IC0gcDEueDtcbiAgICBsZXQgZHkgPSBwMC55IC0gcDEueTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgfVxuXG4gIGRpc3RhbmNlWFkoeDAsIHkwLCB4MSwgeTEpIHtcbiAgICBsZXQgZHggPSB4MSAtIHgwO1xuICAgIGxldCBkeSA9IHkxIC0geTA7XG4gICAgcmV0dXJuIE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gIH1cblxuICAvLyBUT0RPOiBDaGVjayBpZiBhbmQgd2h5IHdlIG5lZWQgdG8gcGFyc2VJbnQoKSB0aGUgcmVzdWx0XG4gIG1hcFJhbmdlKHZhbHVlLCBsb3cxLCBoaWdoMSwgbG93MiwgaGlnaDIpIHtcbiAgICByZXR1cm4gcmVzdWx0ID0gbG93MiArIChoaWdoMiAtIGxvdzIpICogKHZhbHVlIC0gbG93MSkgLyAoaGlnaDEgLSBsb3cxKTtcbiAgICBsZXQgcmVzdWx0ID0gbG93MiArIChoaWdoMiAtIGxvdzIpICogKHZhbHVlIC0gbG93MSkgLyAoaGlnaDEgLSBsb3cxKTtcbiAgICBpZiAobG93MiA9PT0gcGFyc2VJbnQobG93MiwgMTApIHx8IGhpZ2gyID09PSBwYXJzZUludChoaWdoMiwgMTApKSB7XG4gICAgICByZXN1bHQgPSBwYXJzZUludChyZXN1bHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgaW5SYW5nZSh2YWx1ZSwgbWluLCBtYXgpIHtcbiAgICByZXR1cm4gdmFsdWUgPj0gTWF0aC5taW4obWluLCBtYXgpICYmIHZhbHVlIDw9IE1hdGgubWF4KG1pbiwgbWF4KTtcbiAgfVxuXG4gIHJhbmdlSW50ZXJzZWN0KG1pbjAsIG1heDAsIG1pbjEsIG1heDEpIHtcbiAgICByZXR1cm4gIE1hdGgubWF4KG1pbjAsIG1heDApID49IE1hdGgubWluKG1pbjEsIG1heDEpICYmXG4gICAgTWF0aC5taW4obWluMCwgbWF4MCkgPD0gTWF0aC5tYXgobWluMSwgbWF4MSk7XG4gIH1cblxuICByYW5kb21SYW5nZShtaW4sIG1heCkge1xuICAgIHJldHVybiBtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbik7XG4gIH1cblxuICBjb25zdHJhaW4oZSx0LHIpIHtcbiAgICByZXR1cm4gZT5yP3I6ZTx0P3Q6ZTtcbiAgfVxuXG4gIGNpcmNsZUNvbGxpc2lvbihjMCwgYzEpIHtcbiAgICByZXR1cm4gdGhpcy5kaXN0YW5jZShjMCwgYzEpIDw9IGMwLnJhZGl1cyArIGMxLnJhZGl1cztcbiAgfVxuXG4gIHJlY3RhbmdsZUNvbGxpc2lvbihyMCwgcjEpIHtcbiAgICByZXR1cm4gIHRoaXMucmFuZ2VJbnRlcnNlY3QocjAueCwgcjAueCArIHIwLndpZHRoLCByMS54LCByMS54ICsgcjEud2lkdGgpICYmXG4gICAgdGhpcy5yYW5nZUludGVyc2VjdChyMC55LCByMC55ICsgcjAuaGVpZ2h0LCByMS55LCByMS55ICsgcjEuaGVpZ2h0KTtcbiAgfVxuXG4gIGNpcmNsZVBvaW50Q29sbGlzaW9uKHB4LCBweSwgY2lyY2xlKSB7XG4gICAgcmV0dXJuIHRoaXMuZGlzdGFuY2VYWShweCwgcHksIGNpcmNsZS54LCBjaXJjbGUueSkgPCBjaXJjbGUucmFkaXVzO1xuICB9XG5cbiAgcmVjdGFuZ2xlUG9pbnRDb2xsaXNpb24ocHgsIHB5LCByZWN0KSB7XG4gICAgcmV0dXJuICB0aGlzLmluUmFuZ2UocHgsIHJlY3QueCwgcmVjdC54ICsgcmVjdC53aWR0aCkgJiZcbiAgICB0aGlzLmluUmFuZ2UocHksIHJlY3QueSwgcmVjdC55ICsgcmVjdC5oZWlnaHQpO1xuICB9XG5cbiAgdW5pcXVlSUQoKSB7XG4gICAgZnVuY3Rpb24gczQoKSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcigoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMClcbiAgICAgICAgLnRvU3RyaW5nKDE2KVxuICAgICAgICAuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICByZXR1cm4gczQoKSArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArXG4gICAgICBzNCgpICsgJy0nICsgczQoKSArIHM0KCkgKyBzNCgpO1xuICB9XG5cbiAgcmFuZG9tQ29sb3IoKSB7XG4gICAgcmV0dXJuIFwiIzAwMDAwMFwiLnJlcGxhY2UoLzAvZyxmdW5jdGlvbigpe3JldHVybiAofn4oTWF0aC5yYW5kb20oKSoxNikpLnRvU3RyaW5nKDE2KTt9KTtcbiAgfVxufVxuXG5sZXQgaW5zdGFuY2UgPSBuZXcgVXRpbHMoKTtcblxuZXhwb3J0IGRlZmF1bHQgaW5zdGFuY2U7XG4iXX0="}