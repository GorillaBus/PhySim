{"version":3,"sources":["node_modules/browser-pack/_prelude.js","projects/easing/app.js","src/feature-toggle.js","src/lib/AnimationPlayer.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import AnimationPlayer from '../../src/lib/AnimationPlayer';\n\nwindow.onload = () => {\n    const canvas = document.getElementById(\"canvas\");\n    const ctx = canvas.getContext(\"2d\");\n    const width = window.innerWidth;\n    const height = window.innerHeight-4;\n    const center = { x: width/2, y: height/2 };\n\n    canvas.height = height;\n    canvas.width = width;\n\n    let player = new AnimationPlayer({ fps: 90 });\n    let target = {\n      x: center.x,\n      y: center.y\n    };\n    let point = {\n      x: 0,\n      y: 0\n    };\n    let ease = 0.1;\n\n    // Demo player setup\n    player.setUpdateFn(update);\n    player.play();\n\n    // Frame drawing function\n    function update() {\n        ctx.clearRect(0,0, width, height);\n\n        // Draw\n        ctx.beginPath();\n        ctx.arc(point.x, point.y, 4, 0, Math.PI * 2, false);\n        ctx.fillStyle = \"#000000\";\n        ctx.fill();\n        ctx.closePath();\n        ctx.stroke();\n\n        easeTo(point, target, ease);\n    }\n\n    function easeTo(position, target, ease) {\n      let dx = target.x - position.x;\n      let dy = target.y - position.y;\n      position.x += dx * ease;\n      position.y += dy * ease;\n      if (Math.abs(dx) < 0.1 && Math.abs(dy) < 0.1) {\n        position.x = target.x;\n        position.y = target.y;\n        return false;\n      }\n      return true;\n    }\n\n    // Mouse event\n    document.body.addEventListener(\"mousemove\", (e) => {\n      target.x = e.clientX;\n      target.y = e.clientY;\n    });\n\n    // Animation control: KeyDown\n    document.body.addEventListener(\"keydown\", (e) => {\n      //console.log(\"Key pressed: \", e.keyCode);\n      switch (e.keyCode) {\n        case 27:                        // Esc\n          if (player.playing) {\n              player.stop();\n              console.log(\"> Scene stopped\");\n          } else {\n              player.play();\n              console.log(\"> Playing scene\");\n          }\n          break;\n\n        default:\n          break;\n      }\n    });\n\n};\n","/*\n *  Feature Toggling\n *\n *  Activete/Hide features that are in process of development or under testing\n *  Once a feature is accepted to be includded must be removed from the\n *  feature toggle scheme\n */\n\n const FEATURE_TOGGLE = {\n   FPS_CONTROL: true                // FPS controll for AnimationPlayer class\n };\n\n export default FEATURE_TOGGLE;\n","import FEATURE_TOGGLE from '../../src/feature-toggle';\n\nexport default class AnimationPlayer {\n\n  constructor(settings) {\n    settings = settings || {};\n\n    this.window = settings.windowElement || window;\n    this.requestId = null;\n    this.playing = false;\n\n    // FPS control\n    this.fps = settings.fps || 90;\n    this.now;\n    this.lastTime = Date.now();\n    this.interval = 1000/this.fps;\n    this.delta;\n\n    this.registerEvents();\n  }\n\n  registerEvents() {\n    // Animation control: KeyDown\n    document.body.addEventListener(\"keydown\", (e) => {\n      //console.log(\"Key pressed: \", e.keyCode);\n      switch (e.keyCode) {\n        case 27:                        // Esc\n        if (this.playing) {\n          this.stop();\n          console.log(\"> Scene stopped\");\n        } else {\n          this.play();\n          console.log(\"> Playing scene\");\n        }\n        break;\n\n        case 13:\n        this.stop();\n        this.play();\n        this.stop();\n        console.log(\"> Step forward\");\n        break;\n\n        default:\n        break;\n      }\n    });\n  }\n\n  play() {\n    this.playing = true;\n    this.updateFn();\n  }\n\n  stop() {\n    if (!this.playing) {\n      return false;\n    }\n    this.window.cancelAnimationFrame(this.requestId);\n    this.playing = false;\n    this.requestId = null;\n  }\n\n  setUpdateFn(updateFn) {\n    this.updateFn = (\n      () => {\n        this.requestId = this.window.requestAnimationFrame(this.updateFn);\n        this.now = Date.now();\n        this.delta = this.now - this.lastTime;\n\n        if (this.delta > this.interval) {\n          this.lastTime = this.now - (this.delta % this.interval);\n          updateFn(this.delta, this.lastTime);\n        }\n        return;\n\n\n        updateFn();\n\n      });\n    }\n\n    updateFn() {\n      console.warn(\"Player update function has not been set.\");\n    }\n  }\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJwcm9qZWN0cy9lYXNpbmcvYXBwLmpzIiwic3JjL2ZlYXR1cmUtdG9nZ2xlLmpzIiwic3JjL2xpYi9BbmltYXRpb25QbGF5ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBOzs7Ozs7QUFFQSxPQUFPLE1BQVAsR0FBZ0IsWUFBTTtBQUNsQixNQUFNLFNBQVMsU0FBUyxjQUFULENBQXdCLFFBQXhCLENBQWY7QUFDQSxNQUFNLE1BQU0sT0FBTyxVQUFQLENBQWtCLElBQWxCLENBQVo7QUFDQSxNQUFNLFFBQVEsT0FBTyxVQUFyQjtBQUNBLE1BQU0sU0FBUyxPQUFPLFdBQVAsR0FBbUIsQ0FBbEM7QUFDQSxNQUFNLFNBQVMsRUFBRSxHQUFHLFFBQU0sQ0FBWCxFQUFjLEdBQUcsU0FBTyxDQUF4QixFQUFmOztBQUVBLFNBQU8sTUFBUCxHQUFnQixNQUFoQjtBQUNBLFNBQU8sS0FBUCxHQUFlLEtBQWY7O0FBRUEsTUFBSSxTQUFTLDhCQUFvQixFQUFFLEtBQUssRUFBUCxFQUFwQixDQUFiO0FBQ0EsTUFBSSxTQUFTO0FBQ1gsT0FBRyxPQUFPLENBREM7QUFFWCxPQUFHLE9BQU87QUFGQyxHQUFiO0FBSUEsTUFBSSxRQUFRO0FBQ1YsT0FBRyxDQURPO0FBRVYsT0FBRztBQUZPLEdBQVo7QUFJQSxNQUFJLE9BQU8sR0FBWDs7QUFFQTtBQUNBLFNBQU8sV0FBUCxDQUFtQixNQUFuQjtBQUNBLFNBQU8sSUFBUDs7QUFFQTtBQUNBLFdBQVMsTUFBVCxHQUFrQjtBQUNkLFFBQUksU0FBSixDQUFjLENBQWQsRUFBZ0IsQ0FBaEIsRUFBbUIsS0FBbkIsRUFBMEIsTUFBMUI7O0FBRUE7QUFDQSxRQUFJLFNBQUo7QUFDQSxRQUFJLEdBQUosQ0FBUSxNQUFNLENBQWQsRUFBaUIsTUFBTSxDQUF2QixFQUEwQixDQUExQixFQUE2QixDQUE3QixFQUFnQyxLQUFLLEVBQUwsR0FBVSxDQUExQyxFQUE2QyxLQUE3QztBQUNBLFFBQUksU0FBSixHQUFnQixTQUFoQjtBQUNBLFFBQUksSUFBSjtBQUNBLFFBQUksU0FBSjtBQUNBLFFBQUksTUFBSjs7QUFFQSxXQUFPLEtBQVAsRUFBYyxNQUFkLEVBQXNCLElBQXRCO0FBQ0g7O0FBRUQsV0FBUyxNQUFULENBQWdCLFFBQWhCLEVBQTBCLE1BQTFCLEVBQWtDLElBQWxDLEVBQXdDO0FBQ3RDLFFBQUksS0FBSyxPQUFPLENBQVAsR0FBVyxTQUFTLENBQTdCO0FBQ0EsUUFBSSxLQUFLLE9BQU8sQ0FBUCxHQUFXLFNBQVMsQ0FBN0I7QUFDQSxhQUFTLENBQVQsSUFBYyxLQUFLLElBQW5CO0FBQ0EsYUFBUyxDQUFULElBQWMsS0FBSyxJQUFuQjtBQUNBLFFBQUksS0FBSyxHQUFMLENBQVMsRUFBVCxJQUFlLEdBQWYsSUFBc0IsS0FBSyxHQUFMLENBQVMsRUFBVCxJQUFlLEdBQXpDLEVBQThDO0FBQzVDLGVBQVMsQ0FBVCxHQUFhLE9BQU8sQ0FBcEI7QUFDQSxlQUFTLENBQVQsR0FBYSxPQUFPLENBQXBCO0FBQ0EsYUFBTyxLQUFQO0FBQ0Q7QUFDRCxXQUFPLElBQVA7QUFDRDs7QUFFRDtBQUNBLFdBQVMsSUFBVCxDQUFjLGdCQUFkLENBQStCLFdBQS9CLEVBQTRDLFVBQUMsQ0FBRCxFQUFPO0FBQ2pELFdBQU8sQ0FBUCxHQUFXLEVBQUUsT0FBYjtBQUNBLFdBQU8sQ0FBUCxHQUFXLEVBQUUsT0FBYjtBQUNELEdBSEQ7O0FBS0E7QUFDQSxXQUFTLElBQVQsQ0FBYyxnQkFBZCxDQUErQixTQUEvQixFQUEwQyxVQUFDLENBQUQsRUFBTztBQUMvQztBQUNBLFlBQVEsRUFBRSxPQUFWO0FBQ0UsV0FBSyxFQUFMO0FBQWdDO0FBQzlCLFlBQUksT0FBTyxPQUFYLEVBQW9CO0FBQ2hCLGlCQUFPLElBQVA7QUFDQSxrQkFBUSxHQUFSLENBQVksaUJBQVo7QUFDSCxTQUhELE1BR087QUFDSCxpQkFBTyxJQUFQO0FBQ0Esa0JBQVEsR0FBUixDQUFZLGlCQUFaO0FBQ0g7QUFDRDs7QUFFRjtBQUNFO0FBWko7QUFjRCxHQWhCRDtBQWtCSCxDQTlFRDs7Ozs7Ozs7QUNGQTs7Ozs7Ozs7QUFRQyxJQUFNLGlCQUFpQjtBQUNyQixlQUFhLElBRFEsQ0FDWTtBQURaLENBQXZCOztrQkFJZSxjOzs7Ozs7Ozs7OztBQ1poQjs7Ozs7Ozs7SUFFcUIsZTtBQUVuQiwyQkFBWSxRQUFaLEVBQXNCO0FBQUE7O0FBQ3BCLGVBQVcsWUFBWSxFQUF2Qjs7QUFFQSxTQUFLLE1BQUwsR0FBYyxTQUFTLGFBQVQsSUFBMEIsTUFBeEM7QUFDQSxTQUFLLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLLE9BQUwsR0FBZSxLQUFmOztBQUVBO0FBQ0EsU0FBSyxHQUFMLEdBQVcsU0FBUyxHQUFULElBQWdCLEVBQTNCO0FBQ0EsU0FBSyxHQUFMO0FBQ0EsU0FBSyxRQUFMLEdBQWdCLEtBQUssR0FBTCxFQUFoQjtBQUNBLFNBQUssUUFBTCxHQUFnQixPQUFLLEtBQUssR0FBMUI7QUFDQSxTQUFLLEtBQUw7O0FBRUEsU0FBSyxjQUFMO0FBQ0Q7Ozs7cUNBRWdCO0FBQUE7O0FBQ2Y7QUFDQSxlQUFTLElBQVQsQ0FBYyxnQkFBZCxDQUErQixTQUEvQixFQUEwQyxVQUFDLENBQUQsRUFBTztBQUMvQztBQUNBLGdCQUFRLEVBQUUsT0FBVjtBQUNFLGVBQUssRUFBTDtBQUFnQztBQUNoQyxnQkFBSSxNQUFLLE9BQVQsRUFBa0I7QUFDaEIsb0JBQUssSUFBTDtBQUNBLHNCQUFRLEdBQVIsQ0FBWSxpQkFBWjtBQUNELGFBSEQsTUFHTztBQUNMLG9CQUFLLElBQUw7QUFDQSxzQkFBUSxHQUFSLENBQVksaUJBQVo7QUFDRDtBQUNEOztBQUVBLGVBQUssRUFBTDtBQUNBLGtCQUFLLElBQUw7QUFDQSxrQkFBSyxJQUFMO0FBQ0Esa0JBQUssSUFBTDtBQUNBLG9CQUFRLEdBQVIsQ0FBWSxnQkFBWjtBQUNBOztBQUVBO0FBQ0E7QUFuQkY7QUFxQkQsT0F2QkQ7QUF3QkQ7OzsyQkFFTTtBQUNMLFdBQUssT0FBTCxHQUFlLElBQWY7QUFDQSxXQUFLLFFBQUw7QUFDRDs7OzJCQUVNO0FBQ0wsVUFBSSxDQUFDLEtBQUssT0FBVixFQUFtQjtBQUNqQixlQUFPLEtBQVA7QUFDRDtBQUNELFdBQUssTUFBTCxDQUFZLG9CQUFaLENBQWlDLEtBQUssU0FBdEM7QUFDQSxXQUFLLE9BQUwsR0FBZSxLQUFmO0FBQ0EsV0FBSyxTQUFMLEdBQWlCLElBQWpCO0FBQ0Q7OztnQ0FFVyxRLEVBQVU7QUFBQTs7QUFDcEIsV0FBSyxRQUFMLEdBQ0UsWUFBTTtBQUNKLGVBQUssU0FBTCxHQUFpQixPQUFLLE1BQUwsQ0FBWSxxQkFBWixDQUFrQyxPQUFLLFFBQXZDLENBQWpCO0FBQ0EsZUFBSyxHQUFMLEdBQVcsS0FBSyxHQUFMLEVBQVg7QUFDQSxlQUFLLEtBQUwsR0FBYSxPQUFLLEdBQUwsR0FBVyxPQUFLLFFBQTdCOztBQUVBLFlBQUksT0FBSyxLQUFMLEdBQWEsT0FBSyxRQUF0QixFQUFnQztBQUM5QixpQkFBSyxRQUFMLEdBQWdCLE9BQUssR0FBTCxHQUFZLE9BQUssS0FBTCxHQUFhLE9BQUssUUFBOUM7QUFDQSxtQkFBUyxPQUFLLEtBQWQsRUFBcUIsT0FBSyxRQUExQjtBQUNEO0FBQ0Q7O0FBR0E7QUFFRCxPQWZIO0FBZ0JDOzs7K0JBRVU7QUFDVCxjQUFRLElBQVIsQ0FBYSwwQ0FBYjtBQUNEOzs7Ozs7a0JBbEZnQixlIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCBBbmltYXRpb25QbGF5ZXIgZnJvbSAnLi4vLi4vc3JjL2xpYi9BbmltYXRpb25QbGF5ZXInO1xuXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpO1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgY29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQtNDtcbiAgICBjb25zdCBjZW50ZXIgPSB7IHg6IHdpZHRoLzIsIHk6IGhlaWdodC8yIH07XG5cbiAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuXG4gICAgbGV0IHBsYXllciA9IG5ldyBBbmltYXRpb25QbGF5ZXIoeyBmcHM6IDkwIH0pO1xuICAgIGxldCB0YXJnZXQgPSB7XG4gICAgICB4OiBjZW50ZXIueCxcbiAgICAgIHk6IGNlbnRlci55XG4gICAgfTtcbiAgICBsZXQgcG9pbnQgPSB7XG4gICAgICB4OiAwLFxuICAgICAgeTogMFxuICAgIH07XG4gICAgbGV0IGVhc2UgPSAwLjE7XG5cbiAgICAvLyBEZW1vIHBsYXllciBzZXR1cFxuICAgIHBsYXllci5zZXRVcGRhdGVGbih1cGRhdGUpO1xuICAgIHBsYXllci5wbGF5KCk7XG5cbiAgICAvLyBGcmFtZSBkcmF3aW5nIGZ1bmN0aW9uXG4gICAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgLy8gRHJhd1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5hcmMocG9pbnQueCwgcG9pbnQueSwgNCwgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwiIzAwMDAwMFwiO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcblxuICAgICAgICBlYXNlVG8ocG9pbnQsIHRhcmdldCwgZWFzZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZWFzZVRvKHBvc2l0aW9uLCB0YXJnZXQsIGVhc2UpIHtcbiAgICAgIGxldCBkeCA9IHRhcmdldC54IC0gcG9zaXRpb24ueDtcbiAgICAgIGxldCBkeSA9IHRhcmdldC55IC0gcG9zaXRpb24ueTtcbiAgICAgIHBvc2l0aW9uLnggKz0gZHggKiBlYXNlO1xuICAgICAgcG9zaXRpb24ueSArPSBkeSAqIGVhc2U7XG4gICAgICBpZiAoTWF0aC5hYnMoZHgpIDwgMC4xICYmIE1hdGguYWJzKGR5KSA8IDAuMSkge1xuICAgICAgICBwb3NpdGlvbi54ID0gdGFyZ2V0Lng7XG4gICAgICAgIHBvc2l0aW9uLnkgPSB0YXJnZXQueTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gTW91c2UgZXZlbnRcbiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgKGUpID0+IHtcbiAgICAgIHRhcmdldC54ID0gZS5jbGllbnRYO1xuICAgICAgdGFyZ2V0LnkgPSBlLmNsaWVudFk7XG4gICAgfSk7XG5cbiAgICAvLyBBbmltYXRpb24gY29udHJvbDogS2V5RG93blxuICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJLZXkgcHJlc3NlZDogXCIsIGUua2V5Q29kZSk7XG4gICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgICBjYXNlIDI3OiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVzY1xuICAgICAgICAgIGlmIChwbGF5ZXIucGxheWluZykge1xuICAgICAgICAgICAgICBwbGF5ZXIuc3RvcCgpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gU2NlbmUgc3RvcHBlZFwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwbGF5ZXIucGxheSgpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gUGxheWluZyBzY2VuZVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcblxufTtcbiIsIi8qXG4gKiAgRmVhdHVyZSBUb2dnbGluZ1xuICpcbiAqICBBY3RpdmV0ZS9IaWRlIGZlYXR1cmVzIHRoYXQgYXJlIGluIHByb2Nlc3Mgb2YgZGV2ZWxvcG1lbnQgb3IgdW5kZXIgdGVzdGluZ1xuICogIE9uY2UgYSBmZWF0dXJlIGlzIGFjY2VwdGVkIHRvIGJlIGluY2x1ZGRlZCBtdXN0IGJlIHJlbW92ZWQgZnJvbSB0aGVcbiAqICBmZWF0dXJlIHRvZ2dsZSBzY2hlbWVcbiAqL1xuXG4gY29uc3QgRkVBVFVSRV9UT0dHTEUgPSB7XG4gICBGUFNfQ09OVFJPTDogdHJ1ZSAgICAgICAgICAgICAgICAvLyBGUFMgY29udHJvbGwgZm9yIEFuaW1hdGlvblBsYXllciBjbGFzc1xuIH07XG5cbiBleHBvcnQgZGVmYXVsdCBGRUFUVVJFX1RPR0dMRTtcbiIsImltcG9ydCBGRUFUVVJFX1RPR0dMRSBmcm9tICcuLi8uLi9zcmMvZmVhdHVyZS10b2dnbGUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBbmltYXRpb25QbGF5ZXIge1xuXG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzKSB7XG4gICAgc2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7fTtcblxuICAgIHRoaXMud2luZG93ID0gc2V0dGluZ3Mud2luZG93RWxlbWVudCB8fCB3aW5kb3c7XG4gICAgdGhpcy5yZXF1ZXN0SWQgPSBudWxsO1xuICAgIHRoaXMucGxheWluZyA9IGZhbHNlO1xuXG4gICAgLy8gRlBTIGNvbnRyb2xcbiAgICB0aGlzLmZwcyA9IHNldHRpbmdzLmZwcyB8fCA5MDtcbiAgICB0aGlzLm5vdztcbiAgICB0aGlzLmxhc3RUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLmludGVydmFsID0gMTAwMC90aGlzLmZwcztcbiAgICB0aGlzLmRlbHRhO1xuXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50cygpO1xuICB9XG5cbiAgcmVnaXN0ZXJFdmVudHMoKSB7XG4gICAgLy8gQW5pbWF0aW9uIGNvbnRyb2w6IEtleURvd25cbiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgICAvL2NvbnNvbGUubG9nKFwiS2V5IHByZXNzZWQ6IFwiLCBlLmtleUNvZGUpO1xuICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgY2FzZSAyNzogICAgICAgICAgICAgICAgICAgICAgICAvLyBFc2NcbiAgICAgICAgaWYgKHRoaXMucGxheWluZykge1xuICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiPiBTY2VuZSBzdG9wcGVkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiPiBQbGF5aW5nIHNjZW5lXCIpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgMTM6XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPiBTdGVwIGZvcndhcmRcIik7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcGxheSgpIHtcbiAgICB0aGlzLnBsYXlpbmcgPSB0cnVlO1xuICAgIHRoaXMudXBkYXRlRm4oKTtcbiAgfVxuXG4gIHN0b3AoKSB7XG4gICAgaWYgKCF0aGlzLnBsYXlpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy53aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5yZXF1ZXN0SWQpO1xuICAgIHRoaXMucGxheWluZyA9IGZhbHNlO1xuICAgIHRoaXMucmVxdWVzdElkID0gbnVsbDtcbiAgfVxuXG4gIHNldFVwZGF0ZUZuKHVwZGF0ZUZuKSB7XG4gICAgdGhpcy51cGRhdGVGbiA9IChcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSB0aGlzLndpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy51cGRhdGVGbik7XG4gICAgICAgIHRoaXMubm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5kZWx0YSA9IHRoaXMubm93IC0gdGhpcy5sYXN0VGltZTtcblxuICAgICAgICBpZiAodGhpcy5kZWx0YSA+IHRoaXMuaW50ZXJ2YWwpIHtcbiAgICAgICAgICB0aGlzLmxhc3RUaW1lID0gdGhpcy5ub3cgLSAodGhpcy5kZWx0YSAlIHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICAgIHVwZGF0ZUZuKHRoaXMuZGVsdGEsIHRoaXMubGFzdFRpbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcblxuXG4gICAgICAgIHVwZGF0ZUZuKCk7XG5cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZUZuKCkge1xuICAgICAgY29uc29sZS53YXJuKFwiUGxheWVyIHVwZGF0ZSBmdW5jdGlvbiBoYXMgbm90IGJlZW4gc2V0LlwiKTtcbiAgICB9XG4gIH1cbiJdfQ=="}