<!DOCTYPE html>
<html>
<head>
    <title>Friction Demo</title>
    <link rel="stylesheet" type="text/css" href="./demos.css" />
    <script>

    var player;
    
    // Browser compatibility hack
    var module = function() {
        this.exports = function() { };
    };

    window.onload = function() {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var width = canvas.width = window.innerWidth-4;
        var height = canvas.height = window.innerHeight-4;

        var particleCfg = {
            x: width / 2,
            y: height / 2,
            speed: 10,
            direction: Math.random() * Math.PI * 2,
            radius: 10,
            friction: 0.97
        };
        var p = Particle.create(particleCfg);

        // For a real friction, use this
        var friction = Vector.create({ x:0, y:0, length: 0.15 });


        // Demo player
        player = AnimationPlayer.create();        
        player.setUpdateFn(update);
        player.play();


        // Frame drawing function
        function update(updateFn) {
            ctx.clearRect(0,0, width, height);            

            /*
            // Real friction method (cpu intensive)
            if (p.velocity.getLength() > friction.getLength()) {
                friction.setAngle(p.velocity.getAngle());
                p.velocity.substractFrom(friction);
            } else {
                p.velocity.setLength(0);
            }
            */
            p.update();

            ctx.beginPath();
            ctx.arc(p.position.getX(), p.position.getY(), p.radius, Math.PI * 2, false);
            ctx.fill();
            ctx.closePath();
        }

        // Animation control: KeyDown
        document.body.addEventListener("keydown", function(e) {
            //console.log("Key pressed: ", e.keyCode);
            switch (e.keyCode) {
                case 38:                        // Up
                    thrusting = true;
                    break;
                case 37:                        // Left
                    turningLeft = true;
                    break;
                case 39:                        // Right
                    turningRight = true;
                    break;
                case 27:                        // Esc
                    if (player.playing) {
                        player.stop();
                        console.log("> Scene stopped");
                    } else {
                        player.play();
                        console.log("> Playing scene");
                    }
                    break;
                default:
                    break;
            }
        });

    };
    </script>

    <script src="../lib/Vector.js" type="text/javascript"></script>
    <script src="../lib/Particle.js" type="text/javascript"></script>
    <script src="../lib/AnimationPlayer.js" type="text/javascript"></script>
    </head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>