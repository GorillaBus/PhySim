<!DOCTYPE html>
<html>
<head>
    <title>Vector Class Demo</title>
    <link rel="stylesheet" type="text/css" href="demos.css" />
    <script>
    var requestId;
    // Browser compatibility hack
    var module = function() {
        this.exports = function() { };
    };
    window.onload = function() {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var width = canvas.width = window.innerWidth-4;
        var height = canvas.height = window.innerHeight-4;
        var angle = 0;
        var turningLeft = false;
        var turningRight = false;
        var thrusting = false;

        var shipSettings = {
            x: width / 2,
            y: height / 2
        }
        var ship = Particle.create(shipSettings);
        var thrust = Vector.create(0,0);

        update();

        function update() {
            ctx.clearRect(0,0, width, height);            

            if (turningLeft) {
                angle -= 0.05;
            }
            if (turningRight) {
                angle += 0.05;
            }
            if (thrusting) {
                thrust.setAngle(angle);
                thrust.setLength(0.1);
            } else {
                thrust.setLength(0);
            }

            ship.accelerate(thrust);
            ship.update();

            ctx.save();
            ctx.translate(ship.position.getX(), ship.position.getY());
            ctx.rotate(angle);
            // Draw ship
            ctx.beginPath();
            ctx.moveTo(10, 0);
            ctx.lineTo(-10, -7);
            ctx.lineTo(-10, 7);
            ctx.lineTo(10, 0);
            ctx.fill();
            // Draw thrust
            if (thrusting) {
                ctx.moveTo(-10, 0);
                ctx.lineTo(-18, 0);
            }
            ctx.stroke();
            ctx.restore();

            if (ship.position.getX() > width) {
                ship.position.setX(0);
            }
            if (ship.position.getY() > height) {
                ship.position.setY(0);
            }
            if (ship.position.getX() < 0) {
                ship.position.setX(width);
            }
            if (ship.position.getY() < 0) {
                ship.position.setY(height);
            }

            requestId = requestAnimationFrame(update);
        }

        // Animation control: KeyDown
        document.body.addEventListener("keydown", function(e) {
            switch (e.keyCode) {
                case 38:                        // Up
                    thrusting = true;
                    break;
                case 37:                        // Left
                    turningLeft = true;
                    break;
                case 39:                        // Right
                    turningRight = true;
                    break;  
                case 27:                        // Esc
                    if (requestId) {
                        window.cancelAnimationFrame(requestId);
                        requestId = undefined;
                        console.log("> Scene stopped");
                    }
                    break;
                default:
                    break;
            }
        });

        // Animation control: KeyUp
        document.body.addEventListener("keyup", function(e) {
            switch (e.keyCode) {
                case 38:                        // Up
                    thrusting = false;
                    break;
                case 37:                        // Left
                    turningLeft = false;
                    break;
                case 39:                        // Right
                    turningRight = false;
                    break; 
                default:
                    break;
            }
        });
    };
    </script>

    <script src="../lib/vector.js" type="text/javascript"></script>
    <script src="../lib/particle.js" type="text/javascript"></script> 
    </head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>